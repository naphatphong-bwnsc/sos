<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>สร้างหน้าธรรมเนียบคณะกรรมการนักเรียน</title>
  <style>
    :root {
      --bg:#f6fbff;
      --card:#ffffff;
      --accent:#0366d6;
      --muted:#6b7280;
      --border:#e6eefc;
      font-family:"Mitr","Noto Sans Thai",Arial,sans-serif;
    }
    body{background:var(--bg);margin:0;padding:20px;color:#0b1720;}
    .container{max-width:980px;margin:0 auto;}
    .card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;box-shadow:0 6px 24px rgba(10,20,40,0.04);}
    h1{margin:0 0 8px 0;font-size:20px;color:var(--accent);}
    p.lead{margin:0 0 16px 0;color:var(--muted);}
    label{display:block;margin:12px 0 6px 0;font-weight:600;}
    input[type="text"],textarea{width:100%;padding:10px;border:1px solid #d7e7ff;border-radius:8px;font-size:15px;box-sizing:border-box}
    textarea{min-height:160px;resize:vertical}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 220px}
    button{background:var(--accent);color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
    button.secondary{background:#6c757d}
    .output{margin-top:16px}
    .linkline{padding:10px;border-radius:8px;background:#f0f7ff;border:1px dashed #cfe6ff;color:#034ea2}
    .preview{margin-top:12px;border:1px solid #e6eefc;border-radius:8px;overflow:auto}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;border-bottom:1px solid #eef6ff;text-align:left}
    th{background:#fbfdff;font-weight:700}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .small{font-size:13px;color:var(--muted)}
    .codebox{width:100%;min-height:90px;padding:10px;border-radius:8px;border:1px solid #e6eefc;background:#fbfdff;font-family:monospace;white-space:pre-wrap;overflow:auto}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>สร้างหน้าธรรมเนียบคณะกรรมการนักเรียน</h1>
      <p class="lead">กรอกโค้ด/URL ของ pubhtml5 และรายการชื่อ-นามสกุล ตำแหน่ง (1 คน ต่อ 1 บรรทัด)</p>

      <label for="pub">1) โค้ดหรือ URL ของ pubhtml5</label>
      <input id="pub" type="text" placeholder="เช่น abc123 หรือ https://pubhtml5.com/abc123" />

      <label for="list">2) รายชื่อ (1 คน = 1 บรรทัด)</label>
      <textarea id="list" placeholder="เช่น
นายธนกร บุญศรี ประธานนักเรียน
นางสาวชลธิชา แก้วใจ รองประธาน"></textarea>

      <div class="controls">
        <button onclick="window.generate()">สร้างโค้ดและตาราง</button>
        <button class="secondary" onclick="window.clearAll()">ล้างข้อมูล</button>
        <div style="margin-left:auto" class="small">คัดลอก HTML ที่ได้ไปวางใน Blogger (โหมด HTML)</div>
      </div>

      <div class="output" id="output" aria-live="polite"></div>
    </div>
  </div>

<script>
function detectPubUrl(input){
  if(!input) return null;
  input = input.trim();
  try{
    const u = new URL(input);
    if(u.hostname.includes("pubhtml5.com")) return u.href;
    return u.href;
  }catch(e){
    return "https://pubhtml5.com/" + encodeURIComponent(input);
  }
}

function parseNames(text){
  const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l.length);
  const rows = [];
  lines.forEach(ln=>{
    const lastSpace = ln.lastIndexOf(' ');
    if(lastSpace<=0) rows.push({name:ln,position:""});
    else rows.push({name:ln.substring(0,lastSpace).trim(),position:ln.substring(lastSpace+1).trim()});
  });
  return rows;
}

function buildTableHTML(rows){
  const header='<table class="bwn-table" border="0" cellpadding="0" cellspacing="0"><thead><tr><th>ลำดับ</th><th>ชื่อ-นามสกุล</th><th>ตำแหน่ง</th></tr></thead><tbody>';
  const body=rows.map((r,i)=>`<tr><td>${i+1}</td><td>${escapeHtml(r.name)}</td><td>${escapeHtml(r.position)}</td></tr>`).join('');
  return header+body+'</tbody></table>';
}

function buildEmbedHTML(pubUrl,rows){
  const iframe=`<div class="pubhtml5-embed" style="max-width:100%;margin-bottom:12px;"><iframe src="${escapeHtml(pubUrl)}" style="width:100%;height:600px;border:0;" allowfullscreen></iframe></div>`;
  const table=buildTableHTML(rows);
  const style='<style>.bwn-table{width:100%;border-collapse:collapse;font-family:inherit}.bwn-table th{background:#f8fbff;padding:8px;text-align:left;border-bottom:1px solid #eaf3ff}.bwn-table td{padding:8px;border-bottom:1px solid #f1f8ff}</style>';
  return `<div class="pubhtml5-section">${style}${iframe}${table}</div>`;
}

function escapeHtml(s){
  return String(s||"").replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

window.generate=function(){
  const pubRaw=document.getElementById('pub').value.trim();
  const listRaw=document.getElementById('list').value;
  const out=document.getElementById('output');
  out.innerHTML='';
  if(!pubRaw){out.innerHTML='<div class="card" style="margin-top:12px;background:#fff6f6;color:#8a1f1f;padding:12px;border-radius:8px">⚠️ กรุณากรอกโค้ดหรือ URL ของ pubhtml5</div>';return;}
  if(!listRaw.trim()){out.innerHTML='<div class="card" style="margin-top:12px;background:#fff6f6;color:#8a1f1f;padding:12px;border-radius:8px">⚠️ กรุณากรอกรายชื่ออย่างน้อย 1 คน</div>';return;}

  const pubUrl=detectPubUrl(pubRaw);
  const rows=parseNames(listRaw);

  const previewWrap=document.createElement('div');
  previewWrap.className='card';
  previewWrap.style.marginTop='12px';
  previewWrap.innerHTML=`<strong>ลิงก์ pubhtml5:</strong><div class="linkline" style="margin-top:8px"><a href="${escapeHtml(pubUrl)}" target="_blank">${escapeHtml(pubUrl)}</a></div>`+buildTableHTML(rows);

  const embedHtml=buildEmbedHTML(pubUrl,rows);
  const codeBox=document.createElement('div');
  codeBox.className='codebox';
  codeBox.id='codeForCopy';
  codeBox.textContent=embedHtml;

  const btnWrap=document.createElement('div');
  btnWrap.className='controls';
  btnWrap.style.marginTop='12px';
  btnWrap.innerHTML='<button onclick="window.copyEmbedRaw()">คัดลอกโค้ด HTML</button><button class="secondary" onclick="window.copyPreviewHTML()">คัดลอกตารางเท่านั้น</button><button class="secondary" onclick="window.downloadHtml()">ดาวน์โหลด .html</button>';

  out.appendChild(previewWrap);
  out.appendChild(codeBox);
  out.appendChild(btnWrap);

  document.getElementById('__raw_embed_html')?.remove();
  const hidden=document.createElement('textarea');
  hidden.id='__raw_embed_html';
  hidden.style.display='none';
  hidden.value=embedHtml;
  document.body.appendChild(hidden);

  document.getElementById('__raw_table_html')?.remove();
  const hiddenT=document.createElement('textarea');
  hiddenT.id='__raw_table_html';
  hiddenT.style.display='none';
  hiddenT.value=buildTableHTML(rows);
  document.body.appendChild(hiddenT);
}

function copyToClipboard(text){
  if(navigator.clipboard) return navigator.clipboard.writeText(text);
  const ta=document.createElement('textarea');
  ta.value=text;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);
}

window.copyEmbedRaw=function(){
  const el=document.getElementById('__raw_embed_html');
  if(!el){alert('ยังไม่มีโค้ดให้คัดลอก');return;}
  copyToClipboard(el.value);alert('✅ คัดลอกโค้ด HTML สำเร็จ');
}

window.copyPreviewHTML=function(){
  const el=document.getElementById('__raw_table_html');
  if(!el){alert('ยังไม่มีตารางให้คัดลอก');return;}
  copyToClipboard(el.value);alert('✅ คัดลอกตารางสำเร็จ');
}

window.clearAll=function(){
  if(!confirm('ต้องการล้างข้อมูลทั้งหมดหรือไม่?'))return;
  document.getElementById('pub').value='';
  document.getElementById('list').value='';
  document.getElementById('output').innerHTML='';
}

window.downloadHtml=function(){
  const el=document.getElementById('__raw_embed_html');
  if(!el||!el.value){alert('ยังไม่มีโค้ดให้ดาวน์โหลด');return;}
  const full='<!doctype html><html lang="th"><meta charset="utf-8"><body>'+el.value+'</body></html>';
  const blob=new Blob([full],{type:'text/html'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='pubhtml5_with_list.html';
  a.click();
  URL.revokeObjectURL(a.href);
}
</script>
</body>
</html>
