<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <img src="https://data.bwnsc.in.th/sc.png" alt="BWNSC Logo" class="w-20 h-20 mx-auto mb-4 rounded-full">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h1>
                <p class="text-blue-600 font-semibold">‡∏™‡∏†‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏∏‡∏ç‡∏ß‡∏±‡∏í‡∏ô‡∏≤</p>
            </div>
            
            <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <p class="text-sm text-blue-800 text-center">
                    <i class="fas fa-info-circle mr-2"></i>
                    ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                </p>
            </div>
            
            <div class="text-center">
                <div id="g_id_onload"
                     data-client_id="568612861935-v4fb8pii5mtvibnfsebe1a5ob608eo0c.apps.googleusercontent.com"
                     data-callback="handleCredentialResponse"
                     data-auto_prompt="false">
                </div>
                <div class="g_id_signin"
                     data-type="standard"
                     data-size="large"
                     data-theme="outline"
                     data-text="sign_in_with"
                     data-shape="rectangular"
                     data-logo_alignment="left">
                </div>
            </div>
            
            <div class="mt-6 text-center">
                <p class="text-xs text-gray-500 mb-2">
                    ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏• @bwnsc.in.th ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
                </p>
                <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-left">
                    <p class="text-xs text-yellow-800 font-medium mb-2">üìã ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets:</p>
                    <p class="text-xs text-yellow-700">
                        1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Apps Script<br>
                        2. ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà URL ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î<br>
                        3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Spreadsheet ID
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div id="mainContent" class="container mx-auto px-2 py-4 hidden">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-6">
            <div class="flex justify-between items-start mb-4">
                <div class="flex-1">
                    <img src="https://data.bwnsc.in.th/sc.png" alt="BWNSC Logo" class="w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-3 sm:mb-4 rounded-full">
                </div>
                <div class="flex items-center space-x-3">
                    <div class="text-right">
                        <p id="userInfo" class="text-sm text-gray-600"></p>
                    </div>
                    <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                        <i class="fas fa-sign-out-alt mr-1"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </div>
            </div>
            <h1 class="text-xl sm:text-2xl font-bold text-gray-800 mb-2 px-2 text-center">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h1>
            <p class="text-base sm:text-lg text-blue-600 font-semibold text-center">üìã ‡∏™‡∏†‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏∏‡∏ç‡∏ß‡∏±‡∏í‡∏ô‡∏≤</p>
        </div>



        <!-- Navigation Tabs -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-6">
            <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg">
                <button id="messagesTab" class="flex-1 py-2 px-4 text-sm font-medium rounded-md bg-blue-600 text-white transition-colors">
                    üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                </button>
                <button id="usersTab" class="flex-1 py-2 px-4 text-sm font-medium rounded-md text-gray-600 hover:text-gray-800 transition-colors">
                    üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                </button>
            </div>
        </div>

        <!-- Messages Section -->
        <div id="messagesSection" class="bg-white rounded-lg shadow-lg p-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h2>
                <span id="messageCount" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
            </div>
            <div id="messagesContainer" class="space-y-4">
                <!-- Sample Message Cards -->
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-semibold text-gray-800 text-lg">‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ (‡∏ä‡∏≤‡∏¢)</h3>
                            <p class="text-sm text-gray-600">‡∏£‡∏´‡∏±‡∏™: 38710 | ‡∏ù‡πà‡∏≤‡∏¢: ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£ | ‡∏£‡∏∏‡πà‡∏ô: 65</p>
                        </div>
                        <span class="text-xs text-gray-500">15/01/2024 14:30</span>
                    </div>
                    
                    <div class="mb-3">
                        <p class="font-medium text-gray-700 mb-1">‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</p>
                        <p class="text-sm text-gray-600 mb-2">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ</p>
                        <p class="text-xs text-gray-500">üìß 38710@bwnsc.in.th</p>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <select class="status-select px-3 py-2 text-sm rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-yellow-100 text-yellow-800 font-medium" data-student-id="38710" data-email="38710@bwnsc.in.th" data-name="‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">
                            <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" selected>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                        </select>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleDetails(this)">
                            ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‚ñº
                        </button>
                    </div>
                    
                    <div class="hidden mt-3 pt-3 border-t border-gray-300 text-sm text-gray-600 details-section">
                        <div class="grid grid-cols-2 gap-2">
                            <div><strong>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</strong> ‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>
                            <div><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</strong> 38710@bwnsc.in.th</div>
                        </div>
                    </div>
                </div>

                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-semibold text-gray-800 text-lg">‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏´‡∏ç‡∏¥‡∏á)</h3>
                            <p class="text-sm text-gray-600">‡∏£‡∏´‡∏±‡∏™: 64025 | ‡∏ù‡πà‡∏≤‡∏¢: ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° | ‡∏£‡∏∏‡πà‡∏ô: 64</p>
                        </div>
                        <span class="text-xs text-gray-500">15/01/2024 16:45</span>
                    </div>
                    
                    <div class="mb-3">
                        <p class="font-medium text-gray-700 mb-1">‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                        <p class="text-sm text-gray-600 mb-2">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏≤‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                        <p class="text-xs text-gray-500">üì± 081-234-5678</p>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <select class="status-select px-3 py-2 text-sm rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 bg-blue-100 text-blue-800 font-medium" data-student-id="64025" data-email="somying@email.com" data-name="‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
                            <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" selected>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                        </select>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium" onclick="toggleDetails(this)">
                            ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‚ñº
                        </button>
                    </div>
                    
                    <div class="hidden mt-3 pt-3 border-t border-gray-300 text-sm text-gray-600 details-section">
                        <div class="grid grid-cols-2 gap-2">
                            <div><strong>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</strong> ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</div>
                            <div><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</strong> 081-234-5678</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Management Section -->
        <div id="usersSection" class="bg-white rounded-lg shadow-lg p-4 hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
                <button id="addUserBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                </button>
            </div>
            
            <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <p class="text-sm text-blue-800">
                    <i class="fas fa-info-circle mr-2"></i>
                    ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ
                </p>
            </div>
            
            <div id="usersContainer" class="space-y-3">
                <!-- Users will be displayed here -->
            </div>
        </div>

        <footer class="py-6 sm:py-8 border-t border-gray-200 mt-8 sm:mt-12">
            <div class="text-center px-4">
                <div class="flex items-center justify-center mb-4">
                    <img src="https://data.bwnsc.in.th/sc.png" alt="BWNSC Logo" class="w-6 h-6 sm:w-8 sm:h-8 rounded mr-2">
                    <span class="text-gray-800 font-medium text-sm sm:text-base">‡∏™‡∏†‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏∏‡∏ç‡∏ß‡∏±‡∏í‡∏ô‡∏≤</span>
                </div>
                <div class="flex justify-center space-x-6 mb-4">
                    <a href="https://www.facebook.com/CouncilBoon" class="text-gray-600 hover:text-blue-600 transition-colors text-lg">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="https://www.instagram.com/bwnsc_official/?hl=th" class="text-gray-600 hover:text-pink-600 transition-colors text-lg">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="mailto:scbwn@boon.ac.th" class="text-gray-600 hover:text-blue-600 transition-colors text-lg">
                        <i class="fas fa-envelope"></i>
                    </a>
                    <a href="https://www.bwnsc.in.th" class="text-gray-600 hover:text-blue-600 transition-colors text-lg">
                        <i class="fas fa-globe"></i>
                    </a>
                </div>
                <p class="text-gray-500 text-xs sm:text-sm">¬© 2025 ‡∏™‡∏†‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏∏‡∏ç‡∏ß‡∏±‡∏í‡∏ô‡∏≤ - ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>
                <p class="text-gray-500 text-xs sm:text-sm mt-1">
                    Developed by <span class="font-medium text-gray-700">FNPHAT</span>
                </p>
            </div>
        </footer>
    </div>

    <!-- Email Modal -->
    <div id="emailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg p-4 w-full max-w-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-2 text-center">‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
            <p class="text-sm text-red-600 font-medium text-center mb-4">‚ö†Ô∏è ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"</p>
            <div id="emailContent" class="mb-4 p-3 bg-gray-50 rounded-lg text-sm">
                <!-- Email content will be inserted here -->
            </div>
            <div class="flex space-x-3">
                <button id="cancelEmail" class="flex-1 py-3 px-4 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg font-medium transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="sendEmail" class="flex-1 py-3 px-4 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors">‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</button>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 text-center">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
            
            <form id="addUserForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                    <input type="email" id="userEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="example@bwnsc.in.th" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="userName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                    <select id="userRole" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</option>
                        <option value="‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡∏™‡∏†‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡∏™‡∏†‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                        <option value="‡∏£‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡∏™‡∏†‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">‡∏£‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡∏™‡∏†‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                        <option value="‡πÄ‡∏•‡∏Ç‡∏≤‡∏ô‡∏∏‡∏Å‡∏≤‡∏£">‡πÄ‡∏•‡∏Ç‡∏≤‡∏ô‡∏∏‡∏Å‡∏≤‡∏£</option>
                        <option value="‡πÄ‡∏´‡∏£‡∏±‡∏ç‡∏ç‡∏¥‡∏Å">‡πÄ‡∏´‡∏£‡∏±‡∏ç‡∏ç‡∏¥‡∏Å</option>
                        <option value="‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå">‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                        <option value="‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£">‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
                    </select>
                </div>
                
                <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    </p>
                </div>
            </form>
            
            <div class="flex space-x-3 mt-6">
                <button id="cancelAddUser" class="flex-1 py-3 px-4 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg font-medium transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirmAddUser" class="flex-1 py-3 px-4 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div id="confirmDeleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg p-6 w-full max-w-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 text-center">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
            <p id="deleteConfirmText" class="text-gray-600 text-center mb-6"></p>
            <div class="flex space-x-3">
                <button id="cancelDelete" class="flex-1 py-3 px-4 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg font-medium transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirmDelete" class="flex-1 py-3 px-4 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors">‡∏•‡∏ö</button>
            </div>
        </div>
    </div>

    <script>
        let messages = [];
        let emailLog = [];
        let currentUser = null;

        // Google Apps Script Configuration
        const GOOGLE_APPS_SCRIPT_CONFIG = {
            // URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á
            webAppUrl: 'https://script.google.com/macros/s/AKfycbzjU3j6iIjxLw8uPjws5kMC1o9o-Idm9OVxD_eglU93vMO7ZCwd0eVEQ556ASI5d2Pn/exec',
            // Spreadsheet ID ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            spreadsheetId: '1_maa3xddr7mjLyo_s_yoRjQ-hd1IIuqxMCdiurCj0Yo'
        };

        // User management system
        let authorizedUsers = [
            { email: 'admin@bwnsc.in.th', name: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', role: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', addedDate: '2024-01-01' },
            { email: 'scbwn@boon.ac.th', name: '‡∏™‡∏†‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', role: '‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡∏™‡∏†‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', addedDate: '2024-01-01' },
            { email: 'naphatphong.p@mail.bwnsc.in.th', name: '‡∏ô‡∏†‡∏±‡∏™‡∏û‡∏á‡∏®‡πå ‡∏õ‡∏¥‡∏¢‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏Å‡∏∏‡∏•', role: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', addedDate: '2024-01-15' }
        ];

        // Get authorized emails array
        function getAuthorizedEmails() {
            return authorizedUsers.map(user => user.email);
        }

        // Google Login Handler
        function handleCredentialResponse(response) {
            // Decode JWT token
            const responsePayload = decodeJwtResponse(response.credential);
            
            console.log("ID: " + responsePayload.sub);
            console.log('Full Name: ' + responsePayload.name);
            console.log('Email: ' + responsePayload.email);
            
            // Check if user is authorized
            const userEmail = responsePayload.email;
            const isAuthorized = getAuthorizedEmails().includes(userEmail) || userEmail.endsWith('@bwnsc.in.th');
            
            if (isAuthorized) {
                currentUser = {
                    email: userEmail,
                    name: responsePayload.name,
                    picture: responsePayload.picture
                };
                
                // Log login activity
                logActivity('LOGIN', `${currentUser.name} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö`);
                
                // Show main content
                showMainContent();
            } else {
                alert('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö');
                signOut();
            }
        }

        // Decode JWT token
        function decodeJwtResponse(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        // Show main content after successful login
        function showMainContent() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
            
            // Update user info display
            document.getElementById('userInfo').innerHTML = `
                <span class="font-medium">${currentUser.name}</span><br>
                <span class="text-xs">${currentUser.email}</span>
            `;
        }

        // Sign out function
        function signOut() {
            if (currentUser) {
                logActivity('LOGOUT', `${currentUser.name} ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö`);
            }
            
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            
            // Reset Google Sign-In
            if (typeof google !== 'undefined' && google.accounts) {
                google.accounts.id.disableAutoSelect();
            }
        }

        // Send data to Google Sheets via Apps Script
        async function sendToGoogleSheets(data, sheetName = 'ActivityLog') {
            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_CONFIG.webAppUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addData',
                        sheetName: sheetName,
                        data: data
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    console.log('Data sent to Google Sheets successfully');
                    return true;
                } else {
                    console.error('Error sending to Google Sheets:', result.error);
                    return false;
                }
            } catch (error) {
                console.error('Network error:', error);
                return false;
            }
        }

        // Log activity to Google Sheets
        async function logActivity(action, description) {
            const timestamp = new Date().toLocaleString('th-TH', {
                timeZone: 'Asia/Bangkok',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const logData = [
                timestamp,
                action,
                currentUser ? currentUser.name : 'Unknown',
                currentUser ? currentUser.email : 'Unknown',
                description,
                window.location.href
            ];
            
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets
            const success = await sendToGoogleSheets(logData, 'ActivityLog');
            
            if (!success) {
                // ‡∏´‡∏≤‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô localStorage ‡πÄ‡∏õ‡πá‡∏ô backup
                const logs = JSON.parse(localStorage.getItem('activityLogs') || '[]');
                logs.push({
                    timestamp: timestamp,
                    action: action,
                    user: currentUser ? currentUser.name : 'Unknown',
                    email: currentUser ? currentUser.email : 'Unknown',
                    description: description
                });
                localStorage.setItem('activityLogs', JSON.stringify(logs));
            }
        }

        // Save user data to Google Sheets
        async function saveUserToSheets(userData) {
            const userRow = [
                new Date().toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' }),
                userData.email,
                userData.name,
                userData.role,
                userData.addedDate,
                'ACTIVE'
            ];
            
            return await sendToGoogleSheets(userRow, 'Users');
        }

        // Save message status to Google Sheets
        async function saveMessageStatusToSheets(messageData) {
            const statusRow = [
                new Date().toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' }),
                messageData.studentId,
                messageData.studentName,
                messageData.oldStatus,
                messageData.newStatus,
                currentUser ? currentUser.name : 'Unknown',
                currentUser ? currentUser.email : 'Unknown'
            ];
            
            return await sendToGoogleSheets(statusRow, 'MessageStatus');
        }

        // Log status change activity
        async function logStatusChange(studentId, studentName, oldStatus, newStatus) {
            const description = `‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á ${studentName} (${studentId}) ‡∏à‡∏≤‡∏Å "${oldStatus}" ‡πÄ‡∏õ‡πá‡∏ô "${newStatus}"`;
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Activity Log
            await logActivity('STATUS_CHANGE', description);
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Message Status Sheet
            await saveMessageStatusToSheets({
                studentId: studentId,
                studentName: studentName,
                oldStatus: oldStatus,
                newStatus: newStatus
            });
        }

        // Log email sent activity
        function logEmailSent(studentId, studentName, email) {
            const description = `‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${studentName} (${email})`;
            logActivity('EMAIL_SENT', description);
        }



        // Initialize status colors
        function updateStatusColors() {
            document.querySelectorAll('.status-select').forEach(select => {
                const value = select.value;
                select.className = 'status-select px-3 py-1 text-sm rounded-full border-0 focus:ring-2 focus:ring-blue-500 ';
                
                if (value === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£') {
                    select.className += 'bg-yellow-100 text-yellow-800';
                } else if (value === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£') {
                    select.className += 'bg-blue-100 text-blue-800';
                } else if (value === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô') {
                    select.className += 'bg-green-100 text-green-800';
                }
            });
        }



        // Toggle details function
        function toggleDetails(button) {
            const card = button.closest('.border');
            const details = card.querySelector('.details-section');
            const isHidden = details.classList.contains('hidden');
            
            if (isHidden) {
                details.classList.remove('hidden');
                button.textContent = '‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‚ñ≤';
            } else {
                details.classList.add('hidden');
                button.textContent = '‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‚ñº';
            }
        }





        function attachStatusChangeListener(select) {
            select.addEventListener('change', function() {
                const previousValue = this.getAttribute('data-previous-value') || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';
                const newValue = this.value;
                const studentId = this.getAttribute('data-student-id');
                const email = this.getAttribute('data-email');
                const name = this.getAttribute('data-name');

                // Log status change
                if (previousValue !== newValue) {
                    logStatusChange(studentId, name, previousValue, newValue);
                }

                // Update colors
                updateStatusColors();

                // Check if status changed to "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" from any other status
                if (previousValue !== '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' && newValue === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô') {
                    showEmailModal(studentId, email, name);
                }

                this.setAttribute('data-previous-value', newValue);
            });

            // Set initial previous value
            select.setAttribute('data-previous-value', select.value);
        }

        function showEmailModal(studentId, email, name) {
            const modal = document.getElementById('emailModal');
            const content = document.getElementById('emailContent');
            
            content.innerHTML = `
                <div class="text-center">
                    <div class="mb-4">
                        <i class="fas fa-envelope text-4xl text-blue-600 mb-3"></i>
                        <h4 class="text-lg font-semibold text-gray-800 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h4>
                        <p class="text-gray-600">‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á:</p>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg">
                        <p class="font-semibold text-gray-800">${name}</p>
                        <p class="text-sm text-gray-600">${email}</p>
                        <p class="text-xs text-gray-500">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ${studentId}</p>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');

            // Store data for sending
            modal.setAttribute('data-student-id', studentId);
            modal.setAttribute('data-email', email);
            modal.setAttribute('data-name', name);
        }

        // Modal event listeners (handled below)

        document.getElementById('sendEmail').addEventListener('click', function() {
            const modal = document.getElementById('emailModal');
            const email = modal.getAttribute('data-email');
            const studentId = modal.getAttribute('data-student-id');
            const name = modal.getAttribute('data-name');
            
            // Log email sent
            logEmailSent(studentId, name, email);
            
            // Close modal
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            
            // Show success message
            alert(`‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${email} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
        });

        document.getElementById('cancelEmail').addEventListener('click', function() {
            const modal = document.getElementById('emailModal');
            const selectElement = document.querySelector(`[data-email="${modal.getAttribute('data-email')}"]`);
            
            // Revert status back to previous value
            if (selectElement) {
                const previousValue = selectElement.getAttribute('data-previous-value');
                selectElement.value = previousValue;
                updateStatusColors();
            }
            
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            
            alert('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏• - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏•‡∏±‡∏ö');
        });



        // Tab switching functions
        function switchToMessagesTab() {
            document.getElementById('messagesTab').className = 'flex-1 py-2 px-4 text-sm font-medium rounded-md bg-blue-600 text-white transition-colors';
            document.getElementById('usersTab').className = 'flex-1 py-2 px-4 text-sm font-medium rounded-md text-gray-600 hover:text-gray-800 transition-colors';
            document.getElementById('messagesSection').classList.remove('hidden');
            document.getElementById('usersSection').classList.add('hidden');
        }

        function switchToUsersTab() {
            document.getElementById('usersTab').className = 'flex-1 py-2 px-4 text-sm font-medium rounded-md bg-blue-600 text-white transition-colors';
            document.getElementById('messagesTab').className = 'flex-1 py-2 px-4 text-sm font-medium rounded-md text-gray-600 hover:text-gray-800 transition-colors';
            document.getElementById('usersSection').classList.remove('hidden');
            document.getElementById('messagesSection').classList.add('hidden');
            renderUsers();
        }

        // Render users list
        function renderUsers() {
            const container = document.getElementById('usersContainer');
            container.innerHTML = '';

            authorizedUsers.forEach((user, index) => {
                const userCard = document.createElement('div');
                userCard.className = 'border border-gray-200 rounded-lg p-4 bg-gray-50';
                userCard.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-800 text-lg">${user.name}</h3>
                            <p class="text-sm text-gray-600 mb-1">${user.email}</p>
                            <div class="flex items-center space-x-4 text-xs text-gray-500">
                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${user.role}</span>
                                <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date(user.addedDate).toLocaleDateString('th-TH')}</span>
                            </div>
                        </div>
                        <button onclick="deleteUser(${index})" class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50 transition-colors">
                            <i class="fas fa-trash text-sm"></i>
                        </button>
                    </div>
                `;
                container.appendChild(userCard);
            });
        }

        // Add user function
        async function addUser() {
            const email = document.getElementById('userEmail').value.trim();
            const name = document.getElementById('userName').value.trim();
            const role = document.getElementById('userRole').value;

            if (!email || !name || !role) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            // Check if email already exists
            if (authorizedUsers.some(user => user.email === email)) {
                alert('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }

            // Add new user
            const newUser = {
                email: email,
                name: name,
                role: role,
                addedDate: new Date().toISOString().split('T')[0]
            };

            // Save to Google Sheets
            const success = await saveUserToSheets(newUser);
            
            if (success) {
                authorizedUsers.push(newUser);
                
                // Log activity
                await logActivity('ADD_USER', `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà: ${name} (${email})`);
                
                // Close modal and reset form
                document.getElementById('addUserModal').classList.add('hidden');
                document.getElementById('addUserModal').classList.remove('flex');
                document.getElementById('addUserForm').reset();
                
                // Refresh users list
                renderUsers();
                
                alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ${name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
            } else {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
        }

        // Delete user function
        let userToDelete = null;
        
        function deleteUser(index) {
            userToDelete = index;
            const user = authorizedUsers[index];
            document.getElementById('deleteConfirmText').textContent = `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô "${user.name}" (${user.email}) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`;
            document.getElementById('confirmDeleteModal').classList.remove('hidden');
            document.getElementById('confirmDeleteModal').classList.add('flex');
        }

        function confirmDeleteUser() {
            if (userToDelete !== null) {
                const deletedUser = authorizedUsers[userToDelete];
                authorizedUsers.splice(userToDelete, 1);
                userToDelete = null;
                
                // Close modal
                document.getElementById('confirmDeleteModal').classList.add('hidden');
                document.getElementById('confirmDeleteModal').classList.remove('flex');
                
                // Refresh users list
                renderUsers();
                
                alert(`‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ${deletedUser.name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateStatusColors();
            
            // Attach listeners to existing selects
            document.querySelectorAll('.status-select').forEach(select => {
                attachStatusChangeListener(select);
            });
            


            // Tab switching listeners
            document.getElementById('messagesTab').addEventListener('click', switchToMessagesTab);
            document.getElementById('usersTab').addEventListener('click', switchToUsersTab);

            // Add user modal listeners
            document.getElementById('addUserBtn').addEventListener('click', function() {
                document.getElementById('addUserModal').classList.remove('hidden');
                document.getElementById('addUserModal').classList.add('flex');
            });

            document.getElementById('cancelAddUser').addEventListener('click', function() {
                document.getElementById('addUserModal').classList.add('hidden');
                document.getElementById('addUserModal').classList.remove('flex');
                document.getElementById('addUserForm').reset();
            });

            document.getElementById('confirmAddUser').addEventListener('click', addUser);

            // Delete confirmation modal listeners
            document.getElementById('cancelDelete').addEventListener('click', function() {
                document.getElementById('confirmDeleteModal').classList.add('hidden');
                document.getElementById('confirmDeleteModal').classList.remove('flex');
                userToDelete = null;
            });

            document.getElementById('confirmDelete').addEventListener('click', confirmDeleteUser);

            // Logout button listener
            document.getElementById('logoutBtn').addEventListener('click', signOut);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97098c6f4188d036',t:'MTc1NTQzNzY2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
